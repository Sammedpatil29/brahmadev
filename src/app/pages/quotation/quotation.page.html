<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="back()">
        <ion-icon slot="icon-only" name="arrow-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>
     <div class="d-flex justify-content-between align-items-center">
       <div>
        Generate Quotation
      </div> 
      <div (click)="addLead()">
        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#000000"><path d="M440-440H200v-80h240v-240h80v240h240v80H520v240h-80v-240Z"/></svg>
      </div>
     </div>
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="settings-drawer" [class.open]="showSettings">
    <div class="drawer-inner">
      <ion-item lines="none">
        <ion-label>GST (%)</ion-label>
        <ion-input type="number" [(ngModel)]="gstPercentage"></ion-input>
      </ion-item>
    </div>
  </div>

  <div class="input-container">
    <p class="section-title">CUSTOMER INFO</p>
    <div class="input-group">
      <ion-input [(ngModel)]="customerName" placeholder="Customer Name" class="custom-input"></ion-input>
      <ion-input [(ngModel)]="siteAddress" placeholder="Site Address/City" class="custom-input"></ion-input>
      <ion-input [(ngModel)]="contact" placeholder="Customer Contact Number" class="custom-input"></ion-input>
    </div>

    <p class="section-title">ITEMS</p>
    <div class="items-container">
      <ion-list lines="none">
        <ion-item *ngFor="let item of selectedItems; let i = index">
          <ion-label>
            <h2>{{ item.description }}</h2>
            <p>₹{{ item.price }} / {{ item.unit }}</p>
          </ion-label>
          <ion-input type="number" [(ngModel)]="item.quantity" placeholder="Qty" slot="end" style="max-width: 80px; text-align: right; border-bottom: 1px solid #ccc;"></ion-input>
          <ion-button slot="end" fill="clear" color="danger" (click)="removeItem(i)">
            <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
          </ion-button>
        </ion-item>
      </ion-list>
      <ion-button expand="block" color="dark" mode="ios" (click)="openItemSelectionModal()" class="share-btn">
        Add Items
      </ion-button>
      <ion-item lines="none" class="ion-margin-top">
        <ion-label>Discount (%)</ion-label>
        <ion-input type="number" [(ngModel)]="discountPercentage" placeholder="0" style="max-width: 80px; text-align: right; border-bottom: 1px solid #ccc;" slot="end"></ion-input>
      </ion-item>
    </div>
  </div>

  <div class="result-card" *ngIf="selectedItems.length > 0">
    <div class="row">
      <span>Base Amount</span>
      <span>₹{{ subTotal | number }}</span>
    </div>
    <div class="row" *ngIf="discountPercentage > 0">
      <span>Discount ({{discountPercentage}}%)</span>
      <span>- ₹{{ discountAmount | number }}</span>
    </div>
    <div class="row">
      <span>Total GST</span>
      <span>₹{{ gstAmount | number }}</span>
    </div>
    <div class="divider"></div>
    <div class="row grand-total">
      <span>TOTAL QUOTE</span>
      <span>₹{{ grandTotal | number }}</span>
    </div>
  </div>

  <div class="button-stack">
    <!-- <ion-button expand="block" mode="ios" (click)="generatePDF(false)" class="preview-btn">
      <ion-icon name="eye-outline" slot="start"></ion-icon> View Quotation
    </ion-button> -->
    <ion-button expand="block" mode="ios" color="dark" (click)="generatePDF()" class="share-btn" [disabled]="!customerName || !siteAddress || contact.length < 10 || selectedItems.length === 0">
      <ion-icon name="logo-whatsapp" slot="start"></ion-icon> Share Quotation
    </ion-button>
  </div>

  <ion-modal [isOpen]="isItemModalOpen" (didDismiss)="isItemModalOpen = false">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Select Items</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="isItemModalOpen = false">Close</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <ion-list>
          <ion-item *ngFor="let item of availableItems">
            <ion-checkbox slot="start" color="dark" [(ngModel)]="item.selected"></ion-checkbox>
            <ion-label>
              <h2>{{ item.description }}</h2>
              <p>₹{{ item.price }} / {{ item.unit }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
          <ion-button expand="block" color="dark" mode="ios" class="share-btn" (click)="addSelectedItems()">Add Selected</ion-button>
        
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>