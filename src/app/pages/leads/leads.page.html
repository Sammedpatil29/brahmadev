<ion-header class="ion-no-border pt-4 bg-white">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="back()">
        <ion-icon slot="icon-only" name="arrow-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>
     <div class="d-flex justify-content-between align-items-center">
       <div>
        Business Leads
      </div> 
      <div (click)="addLead()">
        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#000000"><path d="M440-440H200v-80h240v-240h80v240h240v80H520v240h-80v-240Z"/></svg>
      </div>
     </div>
    </ion-title>
  </ion-toolbar>
</ion-header>
<div class="position-sticky bg-white" style="top: 0px; z-index: 999">
    @if (!isLoading) {
      <div class="chip-container pt-0">
  <div class="chip" [class]="searchTerm != ''? '': 'total-count'" (click)="resetSearch()">
    All ({{ leads?.length }})
  </div>

  <div class="chip" [class]="searchTerm == 'scheduled'? 'total-count': ''" (click)="scheduledSearch()">
    Scheduled @if (searchTerm == 'scheduled') {
      <span> ({{ filteredLeads?.length }})</span>
    }
  </div>

  <div *ngFor="let item of response" class="chip" [class]="item == searchTerm ? 'total-count': ''" (click)="filterbyChips(item)">
    <span>{{ item | titlecase}}</span>
    @if (item == searchTerm) {
      <span> ({{ filteredLeads?.length }})</span>
    }
  </div>
</div>
    }
<div>
  <ion-searchbar 
  [(ngModel)]="searchTerm" 
  (ionInput)="handleSearch()" 
  placeholder="Search by name or city">
</ion-searchbar>
</div>
  </div>

  <ion-content class="ion-padding">
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>
@if (!isLoading) {
  
  @if (filteredLeads.length > 0) {
    @for (lead of filteredLeads; track $index) {
    <div class="lead-card-container">
    <ion-card class="modern-lead-card" (click)="viewLead(lead.id)">
      <div class="card-gradient-bar"></div>
      
      <ion-card-content>
        <div class="card-header-row">
          <div class="user-avatar">
            {{ lead.name.charAt(0).toUpperCase() }}
          </div>
          <div class="header-info">
            <h2 class="lead-name">{{ lead.name | titlecase}}</h2>
            <div class="d-flex gap-3">
              @if (lead.platform == 'fb') {
<p class="lead-platform"><ion-icon name="logo-facebook"></ion-icon> {{ lead.platform == 'fb' ? 'Facebook': 'unknown' }}</p>
            } @else if (lead.platform == 'ig') {
<p class="lead-platform"><ion-icon name="logo-instagram" class="text-danger"></ion-icon> {{ lead.platform == 'ig' ? 'Instagram': 'unknown' }}</p>
            } @else {
<p class="lead-platform"><ion-icon name="globe-outline" class="text-dark"></ion-icon> {{ lead.platform || 'unknown' }}</p>
            }

            
              <p [hidden]="lead.visit_schedule == null" class="lead-platform"><svg xmlns="http://www.w3.org/2000/svg" height="15px" viewBox="0 -960 960 960" width="15px" fill="#439400"><path d="M216-96q-29 0-50.5-21.5T144-168v-528q0-29.7 21.5-50.85Q187-768 216-768h72v-96h72v96h240v-96h72v96h72q29 0 50.5 21.15T816-696v244l-72 72v-148H216v360h226l72 72H216Zm424 24L504-208l51-51 85 85 170-170 51 51L640-72Z"/></svg>  &nbsp;{{ lead.visit_schedule | date: 'dd MMM yy' : '+0000'}} - {{ lead.visit_schedule | date: 'hh:mm a' : '+0000' }}</p>
          

            </div>
          </div>
          
        </div>

        <div class="card-body-row">
          <div class="info-item">
            <ion-icon name="call-outline"></ion-icon>
            <span>{{ lead.contact }}</span>
          </div>
          <div class="info-item">
            <ion-icon name="location-outline"></ion-icon>
            <span>{{ lead.city || 'Location N/A' | titlecase }}</span>
          </div>
        </div>

        <div class="card-footer-row">
          <span class="visit-time">
            <ion-icon name="time-outline"></ion-icon>
            {{ lead.time | date:'mediumDate' }} â€¢ {{ lead.time | date:'shortTime' }}
          </span>
          <ion-badge 
  [color]="lead.response == 'Closed' || lead.response == 'Wrong Number' ? 'danger': 'success'" 
  class="status-badge text-white">
  {{lead.response | titlecase}}
</ion-badge>
          <!-- <ion-button fill="clear" size="small" (click)="callLead(lead.contact); $event.stopPropagation()">
            <ion-icon slot="icon-only" name="call"></ion-icon>
          </ion-button> -->
        </div>
      </ion-card-content>
    </ion-card>
  </div>
  }
  } @else {
    <div class="no-data-container d-flex flex-column align-items-center justify-content-center p-5 text-center">
  <div class="icon-wrapper mb-3">
    <svg xmlns="http://www.w3.org/2000/svg" height="64px" viewBox="0 -960 960 960" width="64px" fill="#d1d5db">
      <path d="M480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/>
    </svg>
  </div>
  <h5 class="text-secondary fw-semibold">No Data Found</h5>
  <p class="text-muted small">We couldn't find any leads matching your current criteria.</p>
  <button class="btn btn-outline-primary btn-sm mt-2" (click)="resetSearch()">
    Clear All Filters
  </button>
</div>
  }

} @else {
  <div class="loader" style="
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;">
      <ion-spinner color="primary"></ion-spinner>
    </div>
    }
    </ion-content>

